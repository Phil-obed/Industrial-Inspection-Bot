<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bot Route Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Fixed start coordinates
    const startLat = 7.351136;
    const startLon = -2.341782;

    // Init map
    const map = L.map("map").setView([startLat, startLon], 18);

    // Black tiles (dark theme)
    L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://www.carto.com/">CARTO</a>',
      subdomains: "abcd",
      maxZoom: 20,
    }).addTo(map);

    // Start marker
    const startMarker = L.marker([startLat, startLon]).addTo(map);

    // Store current line
    let routeLine = null;
    let destMarker = null;

    // Function to generate crooked path
    function generateCrookedPath(start, end) {
      const points = [start];

      // Add 2 random midpoints
      for (let i = 0; i < 2; i++) {
        const lat = start.lat + (end.lat - start.lat) * (i + 1) / 3 + (Math.random() - 0.5) * 0.0002;
        const lng = start.lng + (end.lng - start.lng) * (i + 1) / 3 + (Math.random() - 0.5) * 0.0002;
        points.push([lat, lng]);
      }

      points.push([end.lat, end.lng]);
      return points;
    }

    // On click
    map.on("click", function (e) {
      const destLatLng = e.latlng;

      // Remove old line and marker if exists
      if (routeLine) {
        map.removeLayer(routeLine);
      }
      if (destMarker) {
        map.removeLayer(destMarker);
      }

      // Add destination marker
      destMarker = L.marker(destLatLng).addTo(map);

      // Generate crooked path
      const crookedPath = generateCrookedPath(
        { lat: startLat, lng: startLon },
        destLatLng
      );

      // Draw crooked polyline
      routeLine = L.polyline(crookedPath, {
        color: "cyan",
        weight: 4,
      }).addTo(map);
    });
  </script>
</body>
</html>
